// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
/*
 * APEXSAT AI - Amlogic S905X4 Device Tree
 * Halil Dincer - Dincer Tavukculuk / APEX Serisi
 */

/dts-v1/;

#include "meson-s4-s905x4.dtsi"

/ {
    compatible = "apexsat,ai-v1", "amlogic,s905x4", "amlogic,meson-s4";
    model = "APEXSAT AI DVB-S2 Receiver v1.0";

    aliases {
        serial0 = &uart_AO;
        ethernet0 = &ethmac;
    };

    chosen {
        stdout-path = "serial0:115200n8";
    };

    memory@0 {
        device_type = "memory";
        reg = <0x0 0x0 0x0 0x100000000>; /* 4GB DDR4 */
    };

    /* 5V ana guc */
    vcc_5v: regulator-vcc-5v {
        compatible = "regulator-fixed";
        regulator-name = "VCC_5V";
        regulator-min-microvolt = <5000000>;
        regulator-max-microvolt = <5000000>;
        regulator-always-on;
    };

    /* 3.3V guc */
    vcc_3v3: regulator-vcc-3v3 {
        compatible = "regulator-fixed";
        regulator-name = "VCC_3V3";
        regulator-min-microvolt = <3300000>;
        regulator-max-microvolt = <3300000>;
        vin-supply = <&vcc_5v>;
        regulator-always-on;
    };

    /* WiFi 32K clock */
    wifi_32k: wifi-32k {
        compatible = "pwm-clock";
        #clock-cells = <0>;
        clock-frequency = <32768>;
        pwms = <&pwm_ef 0 30518 0>;
    };

    /* HDMI ses */
    hdmi_sound: hdmi-sound {
        compatible = "amlogic,axg-sound-card";
        model = "APEXSAT-HDMI";
        status = "okay";
    };

    /* IR alici */
    ir_receiver: ir-receiver {
        compatible = "gpio-ir-receiver";
        gpios = <&gpio GPIOD_5 GPIO_ACTIVE_LOW>;
        linux,rc-map-name = "rc-apexsat";
    };

    /* Fan PWM kontrolu */
    cooling_fan: cooling-fan {
        compatible = "pwm-fan";
        #cooling-cells = <2>;
        pwms = <&pwm_ef 1 40000 0>;
        cooling-levels = <0 64 128 192 255>;
    };

    /* LED'ler */
    leds {
        compatible = "gpio-leds";

        led_power: led-power {
            label = "apexsat:red:power";
            gpios = <&gpio GPIOD_10 GPIO_ACTIVE_HIGH>;
            default-state = "on";
        };

        led_status: led-status {
            label = "apexsat:green:status";
            gpios = <&gpio GPIOD_11 GPIO_ACTIVE_HIGH>;
            linux,default-trigger = "heartbeat";
        };
    };
};

/* UART debug konsolu */
&uart_AO {
    status = "okay";
    pinctrl-0 = <&uart_ao_a_pins>;
    pinctrl-names = "default";
};

/* HDMI cikis */
&hdmi_tx {
    status = "okay";
    pinctrl-0 = <&hdmitx_hpd_pins>, <&hdmitx_ddc_pins>;
    pinctrl-names = "default";
    hdmi-supply = <&vcc_5v>;
};

/* Ethernet (Gigabit) */
&ethmac {
    status = "okay";
    pinctrl-0 = <&eth_rgmii_pins>;
    pinctrl-names = "default";
    phy-handle = <&external_phy>;
    phy-mode = "rgmii-id";

    mdio {
        #address-cells = <1>;
        #size-cells = <0>;

        external_phy: ethernet-phy@0 {
            compatible = "ethernet-phy-id001c.c916";  /* RTL8211F */
            reg = <0>;
            max-speed = <1000>;
        };
    };
};

/* USB 3.0 */
&usb3_pcie_phy {
    status = "okay";
};

&usb {
    status = "okay";
    dr_mode = "host";
};

/* SD kart */
&sd_emmc_b {
    status = "okay";
    pinctrl-0 = <&sdcard_pins>;
    pinctrl-names = "default";
    bus-width = <4>;
    cap-sd-highspeed;
    sd-uhs-sdr50;
    max-frequency = <100000000>;
    vmmc-supply = <&vcc_3v3>;
};

/* eMMC */
&sd_emmc_c {
    status = "okay";
    pinctrl-0 = <&emmc_pins>;
    pinctrl-names = "default";
    bus-width = <8>;
    cap-mmc-highspeed;
    mmc-hs200-1_8v;
    max-frequency = <200000000>;
    vmmc-supply = <&vcc_3v3>;
    non-removable;
};

/* I2C bus (tuner kontrolu, mikrofon, sensorler) */
&i2c0 {
    status = "okay";
    pinctrl-0 = <&i2c0_pins>;
    pinctrl-names = "default";
    clock-frequency = <400000>;

    /* NIM modulu tuner kontrolu */
    /* Adres NIM modulune gore degisir */
};

&i2c1 {
    status = "okay";
    clock-frequency = <100000>;

    /* OLED ekran (SSD1306) */
    oled_display: ssd1306@3c {
        compatible = "solomon,ssd1306fb-i2c";
        reg = <0x3c>;
        solomon,width = <128>;
        solomon,height = <64>;
    };
};

/* SPI (opsiyonel flash, sensor) */
&spicc0 {
    status = "okay";
    pinctrl-0 = <&spicc0_pins>;
    pinctrl-names = "default";
};

/* PWM (fan, backlight) */
&pwm_ef {
    status = "okay";
    pinctrl-0 = <&pwm_e_pins>;
    pinctrl-names = "default";
};

/* Termal yonetim */
&cpu_thermal {
    trips {
        cpu_passive: cpu-passive {
            temperature = <70000>;
            hysteresis = <5000>;
            type = "passive";
        };

        cpu_hot: cpu-hot {
            temperature = <80000>;
            hysteresis = <5000>;
            type = "hot";
        };

        cpu_critical: cpu-critical {
            temperature = <95000>;
            hysteresis = <2000>;
            type = "critical";
        };
    };

    cooling-maps {
        map0 {
            trip = <&cpu_passive>;
            cooling-device = <&cooling_fan 0 1>;
        };
        map1 {
            trip = <&cpu_hot>;
            cooling-device = <&cooling_fan 2 3>;
        };
    };
};
